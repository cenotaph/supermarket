!!!
%html
  %head
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}
      %title= content_for?(:title) ? yield(:title) : "Supermarket"
      %link{:href => theme_image_path('favicon.ico'), :rel => "shortcut icon"}/
      %meta{:content => content_for?(:description) ? yield(:description) : "Supermarket", :name => "description"}
      %link{:href => posts_path(:format => :rss), :rel => "alternate", :title => "Supermarket Art Fair", :type => "application/rss+xml"}/
      = stylesheet_link_tag :application
      = stylesheet_link_tag 'supermarket2014/stylesheets/application', :media => :screen
      = javascript_include_tag "application"
      / %script{:src => "http://maps.google.com/maps/api/js?sensor=false", :type => "text/javascript"}
      = csrf_meta_tags

      %script{:type => "text/javascript"}
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-9098444-2']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();            
            
        %script{:type => "text/javascript"}
          var switchTo5x=false;
        %script{:type => "text/javascript", :src => "http://w.sharethis.com/button/buttons.js"}
        %script{:type => "text/javascript"} stLight.options({publisher: "fec021ac-bd8c-4517-b7db-cd4a0d0ad212", doNotHash: false, doNotCopy: false, hashAddressBar: false});
        = yield(:head)
  %body
    %header
      .container
        .sixteen.columns.header_main.alpha
          .seven.columns.alpha.header_logo
            = link_to image_tag(theme_image_path('2014siaf_white.png')), '/'
            / = link_to image_tag(theme_image_path('supermarket_top_logo.png')), '/', :class => :tl2
            .dates 
              %p Kulturhuset Stadsteatern
              %p 14-16 February 2014
              %p Friday 11-22
              %p Saturday-Sunday 11-20
          .nine.columns.omega.top_bar_container
            %nav.top_bar
              %ul
                %li.big= link_to t(:tickets), page_path('future-dates')
                / %li= link_to t(:faqs), page_path('faq')
                - if current_user
                  %li= current_user.display_name
                  - if current_user.has_role?(:staff) || current_user.has_role?(:god)
                    %li= link_to 'Admin side', '/admin'
                  %li= link_to t(:sign_out), destroy_user_session_path, :method => :delete
                - else
                  %li= link_to t(:login), new_user_session_path
                  %li= link_to t(:sign_up), new_user_registration_path
                %li
                  = form_tag('/search') do |f|
                    = text_field_tag :searchterm,  t(:search)
            .flash
              - flash.each do |key, value|
                .alert{ :class => "alert-#{key}" }
                  %strong
                    = value                    
            .nine.columns.omega
              .dates_mobile
                %p Kulturhuset Stadsteatern
                %p 14-16 February 2014

              %nav.social_icons
                %ul
                  %li= link_to image_tag(theme_image_path('facebook_icon.png')), 'https://www.facebook.com/supermarketartfair'
                  %li= link_to image_tag(theme_image_path('twitter_icon.png')), 'https://twitter.com/supermarketart'
                  %li= link_to image_tag(theme_image_path('tv_icon.png')), '/tv'
      #menu_base
        .container
          .sixteen_columns.horiz_menu
            %nav.page_menu
              %select
                - Menu.roots.includes(:item).by_subsite(@subsite.id).published.sort_by(&:sort_order).each do |menu|
                  %option{:value => ''} Go to ...
                  %option{:value => menu.link, :selected => (request.path == menu.link ? 'selected' : false)}= menu.item.name
                  - unless menu.children.empty?
                    = render :partial => 'layouts/recursive_select', :locals => {:submenu => menu.children, :depth => menu.depth }
              %ul
                - Menu.roots.includes(:item).by_subsite(@subsite.id).published.sort_by(&:sort_order).each_with_index do |menu, index|
                  %li{:class => [(index == 0 ? :first : false) , (!@page.nil? ? (@page.child_of?(menu) ? :active : false) : false), (request.fullpath == menu.link ? :active : false)], :id => "menu_#{menu.id.to_s}"}= link_to menu.item.name, menu.link
                
      - if @page
        -# top level
        - unless @page.menus.map(&:depth).flatten.compact.uniq == [0] && @page.menus.map(&:children).flatten.compact.empty?
          - unless @page.menus.published.empty?
            = render :partial => 'layouts/recursive_menu', :locals => {:level => 1, :entry => @page, :items => @page.menus.published.first.self_and_ancestors.map(&:self_and_descendants).flatten.delete_if{|x| x.depth != 1  }.sort_by{|x| x.sort_order.to_i}.uniq }
      - else
        - if controller.controller_name =~ /^press/
          - top = Internallink.find_by(:name => 'Press')
          = render :partial => 'layouts/recursive_menu', :locals => {:level => 1, :entry => top, :items => top.menus.published.first.self_and_ancestors.map(&:self_and_descendants).flatten.delete_if{|x| x.depth != 1  }.sort_by{|x| x.sort_order.to_i}.uniq }
        - elsif controller.controller_name =~ /^funders/
          - top = Internallink.find_by(:controller => 'funders')
          = render :partial => 'layouts/recursive_menu', :locals => {:level => 1, :entry => top, :items => top.menus.published.first.self_and_ancestors.map(&:self_and_descendants).flatten.delete_if{|x| x.depth != 1  }.sort_by{|x| x.sort_order.to_i}.uniq }  
    = yield :extra_header
    / #main{:style => (!@background_image.nil? ? "background: url('#{@background_image.background_image.url}') no-repeat top left" : false), :class => controller.controller_name}
    #main{:class => controller.controller_name}
      .container
        - if !content_for?(:sidebar)   || controller.controller_name == 'videos'
          = yield
            
        - else
          .twelve.columns.alpha= yield
          .four.columns.omega

            = yield :sidebar

    %footer
      .container
        
        .five.columns.omega.footer_credits
          %strong Supermarket 2014
          %em Stockholm Independent Art Fair
          .small_text 14-16 February 2014, Kulturhuset Stadsteatern, Stockholm
        

        .four.columns
          %ul
            %li= link_to 'FAQ', page_path('faq')
            %li= link_to 'Tickets', page_path('future-dates')
            %li= link_to 'Super-TV', '/tv'
            %li= link_to 'Exhibitors 2014', '/exhibitors/2014'
            %li= link_to 'Talks and Performances 2014', page_path('talks-performance-2014')
        .four.columns
          %ul
            %li= link_to t(:disclaimer), page_path('disclaimer')
            %li= link_to t(:contact_us), page_path('contact')
            %li.last= link_to t(:subscribe_to_newsletter), 'http://admin.getanewsletter.com/subscription/RAaDe8sxcYaWuhKev/add/', :target => :_blank
        .three.columns.alpha= link_to image_tag(theme_image_path('2014siaf_white.png')), '/'
          
  :javascript
    $(document).ready(function() {
      $('input#searchterm').clearField();
         
      $('nav select').change(function() {
        window.location = $(this).find("option:selected").val();
      });
      #{yield :jquery}
    });

      